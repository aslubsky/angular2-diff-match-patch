{"version":3,"file":"angular2-diff-match-patch.js","sources":["../../src/dmp.service.ts","../../src/line-diff.component.ts","../../src/ng2-diff.module.ts","../../src/angular2-diff-match-patch.ts"],"sourcesContent":["import * as diff_match_patch from 'google-diff-match-patch/diff_match_patch_uncompressed';\n\nexport class DiffMatchPachService {\n    private static displayType:any = {\n        INSDEL: 0,\n        LINEDIFF: 1\n    };\n\n    private diffClass(op) {\n        switch (op) {\n            case diff_match_patch.DIFF_INSERT:\n                return 'ins';\n            case diff_match_patch.DIFF_DELETE:\n                return 'del';\n            default: // case DIFF_EQUAL:\n                return 'match';\n        }\n    }\n\n    private diffSymbol(op) {\n        switch (op) {\n            case diff_match_patch.DIFF_INSERT:\n                return '+';\n            case diff_match_patch.DIFF_DELETE:\n                return '-';\n            default: // case DIFF_EQUAL:\n                return ' ';\n        }\n    }\n\n    private diffTag(op) {\n        switch (op) {\n            case diff_match_patch.DIFF_INSERT:\n                return 'ins';\n            case diff_match_patch.DIFF_DELETE:\n                return 'del';\n            default: // case DIFF_EQUAL:\n                return 'span';\n        }\n    }\n\n    private diffAttrName(op) {\n        switch (op) {\n            case diff_match_patch.DIFF_INSERT:\n                return 'insert';\n            case diff_match_patch.DIFF_DELETE:\n                return 'delete';\n            default: // case DIFF_EQUAL:\n                return 'equal';\n        }\n    }\n\n    private isEmptyObject(o) {\n        return Object.getOwnPropertyNames(o).length === 0;\n    }\n\n    private isDefined(o) {\n        return o != undefined;\n    }\n\n    private getTagAttrs(options, op, attrs?) {\n        var attributes = attrs || {};\n        var tagOptions = {};\n        var attribute;\n        var tagOption;\n        var retVal:string[] = [];\n\n        if (options != undefined && options.attrs != undefined) {\n            tagOptions = Object.assign(options.attrs[this.diffAttrName(op)] || {});\n        }\n\n        if (this.isEmptyObject(tagOptions) && this.isEmptyObject(attributes)) {\n            return '';\n        }\n\n        for (attribute in attributes) {\n            if (this.isDefined(tagOptions[attribute])) {\n                // The attribute defined in attributes should be first\n                tagOptions[attribute] = attributes[attribute] + ' ' + tagOptions[attribute];\n            } else {\n                tagOptions[attribute] = attributes[attribute];\n            }\n        }\n\n        /* eslint guard-for-in: \"off\" */\n        for (tagOption in tagOptions) {\n            retVal.push(tagOption + '=\"' + tagOptions[tagOption] + '\"');\n        }\n        return ' ' + retVal.join(' ');\n    }\n\n    private getHtmlPrefix(op, display, options) {\n        switch (display) {\n            case DiffMatchPachService.displayType.LINEDIFF:\n                return '<div class=\"' + this.diffClass(op) + '\"><span' + this.getTagAttrs(options, op, {class: 'noselect'}) + '>' + this.diffSymbol(op) + '</span>';\n            default: // case displayType.INSDEL:\n                return '<' + this.diffTag(op) + this.getTagAttrs(options, op) + '>';\n        }\n    }\n\n    private getHtmlSuffix(op, display) {\n        switch (display) {\n            case DiffMatchPachService.displayType.LINEDIFF:\n                return '</div>';\n            default: // case displayType.INSDEL:\n                return '</' + this.diffTag(op) + '>';\n        }\n    }\n\n    private createHtmlLines(text, op, options) {\n        var lines = text.split('\\n');\n        var y;\n        for (y = 0; y < lines.length; y++) {\n            if (lines[y].length === 0) {\n                continue;\n            }\n            lines[y] = this.getHtmlPrefix(op, DiffMatchPachService.displayType.LINEDIFF, options) + lines[y] + this.getHtmlSuffix(op, DiffMatchPachService.displayType.LINEDIFF);\n        }\n        return lines.join('');\n    }\n\n    private createHtmlFromDiffs(diffs, display, options) {\n        var patternAmp = /&/g;\n        var patternLt = /</g;\n        var patternGt = />/g;\n        var x;\n        var html:string[] = [];\n        var y;\n        var data;\n        var op;\n        var text;\n        var diffData = diffs;\n\n        for (x = 0; x < diffData.length; x++) {\n            data = diffData[x][1];\n            diffData[x][1] = data.replace(patternAmp, '&amp;')\n                .replace(patternLt, '&lt;')\n                .replace(patternGt, '&gt;');\n        }\n\n        for (y = 0; y < diffData.length; y++) {\n            op = diffData[y][0];\n            text = diffData[y][1];\n            if (display === DiffMatchPachService.displayType.LINEDIFF) {\n                html[y] = this.createHtmlLines(text, op, options);\n            } else {\n                html[y] = this.getHtmlPrefix(op, display, options) + text + this.getHtmlSuffix(op, display);\n            }\n        }\n        return html.join('');\n    }\n\n    private isString(myVar) {\n        return (typeof myVar === 'string' || myVar instanceof String);\n    }\n\n    private assertArgumentsIsStrings(left, right) {\n        return this.isString(left) && this.isString(right);\n    }\n\n    public createDiffHtml(left, right, options) {\n        var dmp;\n        var diffs;\n        if (this.assertArgumentsIsStrings(left, right)) {\n            dmp = new diff_match_patch.diff_match_patch();\n            diffs = dmp.diff_main(left, right);\n            return this.createHtmlFromDiffs(diffs, DiffMatchPachService.displayType.INSDEL, options);\n        }\n        return '';\n    }\n\n//    createProcessingDiffHtml: function createProcessingDiffHtml(left, right, options) {\n//    var dmp;\n//    var diffs;\n//    if (assertArgumentsIsStrings(left, right)) {\n//        dmp = new diff_match_patch();\n//        diffs = dmp.diff_main(left, right);\n//\n//        if (angular.isDefined(options) && angular.isDefined(options.editCost) && isFinite(options.editCost)) {\n//            dmp.Diff_EditCost = options.editCost; // eslint-disable-line camelcase\n//        }\n//\n//        dmp.diff_cleanupEfficiency(diffs);\n//        return createHtmlFromDiffs(diffs, displayType.INSDEL, options);\n//    }\n//    return '';\n//},\n//\n//    createSemanticDiffHtml: function createSemanticDiffHtml(left, right, options) {\n//    var dmp;\n//    var diffs;\n//    if (assertArgumentsIsStrings(left, right)) {\n//        dmp = new diff_match_patch();\n//        diffs = dmp.diff_main(left, right);\n//        dmp.diff_cleanupSemantic(diffs);\n//        return createHtmlFromDiffs(diffs, displayType.INSDEL, options);\n//    }\n//    return '';\n//},\n\n    public createLineDiffHtml(left, right, options) {\n        var dmp;\n        var chars;\n        var diffs;\n        if (this.assertArgumentsIsStrings(left, right)) {\n            dmp = new diff_match_patch.diff_match_patch();\n            chars = dmp.diff_linesToChars_(left, right);\n            diffs = dmp.diff_main(chars.chars1, chars.chars2, false);\n            dmp.diff_charsToLines_(diffs, chars.lineArray);\n            return this.createHtmlFromDiffs(diffs, DiffMatchPachService.displayType.LINEDIFF, options);\n        }\n        return '';\n    }\n}\n","import {Directive, Input, SimpleChanges, ElementRef, OnInit, OnChanges}         from '@angular/core';\n\nimport {DiffMatchPachService} from './dmp.service';\n\n@Directive({\n    selector: '[line-diff]',\n    providers: [\n        DiffMatchPachService\n    ]\n})\nexport class LineDiffComponent implements OnInit, OnChanges {\n    @Input() left:string;\n    @Input() right:string;\n    @Input() options:{} = {};\n\n    constructor(private el:ElementRef, private dmp:DiffMatchPachService) {\n    }\n\n    public ngOnChanges(changes: SimpleChanges) {\n        this.el.nativeElement.innerHTML = this.dmp.createLineDiffHtml(this.left, this.right, this.options);\n    }\n\n    public ngOnInit() {\n        this.el.nativeElement.innerHTML = this.dmp.createLineDiffHtml(this.left, this.right, this.options);\n    }\n}\n","import {LineDiffComponent} from './line-diff.component';\n\n// (<any>window).diff_match_patch = require('google-diff-match-patch/diff_match_patch_uncompressed');\n\nimport {NgModule} from '@angular/core';\n\n@NgModule({\n    exports: [\n        LineDiffComponent\n    ],\n    declarations: [\n        LineDiffComponent\n    ],\n    imports: []\n})\nexport class Ng2DiffModule {\n}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"],"names":[],"mappings":"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"}