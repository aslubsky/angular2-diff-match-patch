import * as diff_match_patch from 'google-diff-match-patch/diff_match_patch_uncompressed';
export class DiffMatchPachService {
    diffClass(op) {
        switch (op) {
            case diff_match_patch.DIFF_INSERT:
                return 'ins';
            case diff_match_patch.DIFF_DELETE:
                return 'del';
            default: // case DIFF_EQUAL:
                return 'match';
        }
    }
    diffSymbol(op) {
        switch (op) {
            case diff_match_patch.DIFF_INSERT:
                return '+';
            case diff_match_patch.DIFF_DELETE:
                return '-';
            default: // case DIFF_EQUAL:
                return ' ';
        }
    }
    diffTag(op) {
        switch (op) {
            case diff_match_patch.DIFF_INSERT:
                return 'ins';
            case diff_match_patch.DIFF_DELETE:
                return 'del';
            default: // case DIFF_EQUAL:
                return 'span';
        }
    }
    diffAttrName(op) {
        switch (op) {
            case diff_match_patch.DIFF_INSERT:
                return 'insert';
            case diff_match_patch.DIFF_DELETE:
                return 'delete';
            default: // case DIFF_EQUAL:
                return 'equal';
        }
    }
    isEmptyObject(o) {
        return Object.getOwnPropertyNames(o).length === 0;
    }
    isDefined(o) {
        return o != undefined;
    }
    getTagAttrs(options, op, attrs) {
        var attributes = attrs || {};
        var tagOptions = {};
        var attribute;
        var tagOption;
        var retVal = [];
        if (options != undefined && options.attrs != undefined) {
            tagOptions = Object.assign(options.attrs[this.diffAttrName(op)] || {});
        }
        if (this.isEmptyObject(tagOptions) && this.isEmptyObject(attributes)) {
            return '';
        }
        for (attribute in attributes) {
            if (this.isDefined(tagOptions[attribute])) {
                // The attribute defined in attributes should be first
                tagOptions[attribute] = attributes[attribute] + ' ' + tagOptions[attribute];
            }
            else {
                tagOptions[attribute] = attributes[attribute];
            }
        }
        /* eslint guard-for-in: "off" */
        for (tagOption in tagOptions) {
            retVal.push(tagOption + '="' + tagOptions[tagOption] + '"');
        }
        return ' ' + retVal.join(' ');
    }
    getHtmlPrefix(op, display, options) {
        switch (display) {
            case DiffMatchPachService.displayType.LINEDIFF:
                return '<div class="' + this.diffClass(op) + '"><span' + this.getTagAttrs(options, op, { class: 'noselect' }) + '>' + this.diffSymbol(op) + '</span>';
            default: // case displayType.INSDEL:
                return '<' + this.diffTag(op) + this.getTagAttrs(options, op) + '>';
        }
    }
    getHtmlSuffix(op, display) {
        switch (display) {
            case DiffMatchPachService.displayType.LINEDIFF:
                return '</div>';
            default: // case displayType.INSDEL:
                return '</' + this.diffTag(op) + '>';
        }
    }
    createHtmlLines(text, op, options) {
        var lines = text.split('\n');
        var y;
        for (y = 0; y < lines.length; y++) {
            if (lines[y].length === 0) {
                continue;
            }
            lines[y] = this.getHtmlPrefix(op, DiffMatchPachService.displayType.LINEDIFF, options) + lines[y] + this.getHtmlSuffix(op, DiffMatchPachService.displayType.LINEDIFF);
        }
        return lines.join('');
    }
    createHtmlFromDiffs(diffs, display, options) {
        var patternAmp = /&/g;
        var patternLt = /</g;
        var patternGt = />/g;
        var x;
        var html = [];
        var y;
        var data;
        var op;
        var text;
        var diffData = diffs;
        for (x = 0; x < diffData.length; x++) {
            data = diffData[x][1];
            diffData[x][1] = data.replace(patternAmp, '&amp;')
                .replace(patternLt, '&lt;')
                .replace(patternGt, '&gt;');
        }
        for (y = 0; y < diffData.length; y++) {
            op = diffData[y][0];
            text = diffData[y][1];
            if (display === DiffMatchPachService.displayType.LINEDIFF) {
                html[y] = this.createHtmlLines(text, op, options);
            }
            else {
                html[y] = this.getHtmlPrefix(op, display, options) + text + this.getHtmlSuffix(op, display);
            }
        }
        return html.join('');
    }
    isString(myVar) {
        return (typeof myVar === 'string' || myVar instanceof String);
    }
    assertArgumentsIsStrings(left, right) {
        return this.isString(left) && this.isString(right);
    }
    createDiffHtml(left, right, options) {
        var dmp;
        var diffs;
        if (this.assertArgumentsIsStrings(left, right)) {
            dmp = new diff_match_patch.diff_match_patch();
            diffs = dmp.diff_main(left, right);
            return this.createHtmlFromDiffs(diffs, DiffMatchPachService.displayType.INSDEL, options);
        }
        return '';
    }
    //    createProcessingDiffHtml: function createProcessingDiffHtml(left, right, options) {
    //    var dmp;
    //    var diffs;
    //    if (assertArgumentsIsStrings(left, right)) {
    //        dmp = new diff_match_patch();
    //        diffs = dmp.diff_main(left, right);
    //
    //        if (angular.isDefined(options) && angular.isDefined(options.editCost) && isFinite(options.editCost)) {
    //            dmp.Diff_EditCost = options.editCost; // eslint-disable-line camelcase
    //        }
    //
    //        dmp.diff_cleanupEfficiency(diffs);
    //        return createHtmlFromDiffs(diffs, displayType.INSDEL, options);
    //    }
    //    return '';
    //},
    //
    //    createSemanticDiffHtml: function createSemanticDiffHtml(left, right, options) {
    //    var dmp;
    //    var diffs;
    //    if (assertArgumentsIsStrings(left, right)) {
    //        dmp = new diff_match_patch();
    //        diffs = dmp.diff_main(left, right);
    //        dmp.diff_cleanupSemantic(diffs);
    //        return createHtmlFromDiffs(diffs, displayType.INSDEL, options);
    //    }
    //    return '';
    //},
    createLineDiffHtml(left, right, options) {
        var dmp;
        var chars;
        var diffs;
        if (this.assertArgumentsIsStrings(left, right)) {
            dmp = new diff_match_patch.diff_match_patch();
            chars = dmp.diff_linesToChars_(left, right);
            diffs = dmp.diff_main(chars.chars1, chars.chars2, false);
            dmp.diff_charsToLines_(diffs, chars.lineArray);
            return this.createHtmlFromDiffs(diffs, DiffMatchPachService.displayType.LINEDIFF, options);
        }
        return '';
    }
}
DiffMatchPachService.displayType = {
    INSDEL: 0,
    LINEDIFF: 1
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZG1wLnNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiL2hvbWUvYXNsdWJza3kvd29yay9jb2xsYWJvcmF0b3IvYW5ndWxhcjItZGlmZi1tYXRjaC1wYXRjaC9zcmMvIiwic291cmNlcyI6WyJkbXAuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEtBQUssZ0JBQWdCLE1BQU0sdURBQXVELENBQUM7QUFFMUYsTUFBTSxPQUFPLG9CQUFvQjtJQU1yQixTQUFTLENBQUMsRUFBRTtRQUNoQixRQUFRLEVBQUUsRUFBRTtZQUNSLEtBQUssZ0JBQWdCLENBQUMsV0FBVztnQkFDN0IsT0FBTyxLQUFLLENBQUM7WUFDakIsS0FBSyxnQkFBZ0IsQ0FBQyxXQUFXO2dCQUM3QixPQUFPLEtBQUssQ0FBQztZQUNqQixTQUFTLG1CQUFtQjtnQkFDeEIsT0FBTyxPQUFPLENBQUM7U0FDdEI7SUFDTCxDQUFDO0lBRU8sVUFBVSxDQUFDLEVBQUU7UUFDakIsUUFBUSxFQUFFLEVBQUU7WUFDUixLQUFLLGdCQUFnQixDQUFDLFdBQVc7Z0JBQzdCLE9BQU8sR0FBRyxDQUFDO1lBQ2YsS0FBSyxnQkFBZ0IsQ0FBQyxXQUFXO2dCQUM3QixPQUFPLEdBQUcsQ0FBQztZQUNmLFNBQVMsbUJBQW1CO2dCQUN4QixPQUFPLEdBQUcsQ0FBQztTQUNsQjtJQUNMLENBQUM7SUFFTyxPQUFPLENBQUMsRUFBRTtRQUNkLFFBQVEsRUFBRSxFQUFFO1lBQ1IsS0FBSyxnQkFBZ0IsQ0FBQyxXQUFXO2dCQUM3QixPQUFPLEtBQUssQ0FBQztZQUNqQixLQUFLLGdCQUFnQixDQUFDLFdBQVc7Z0JBQzdCLE9BQU8sS0FBSyxDQUFDO1lBQ2pCLFNBQVMsbUJBQW1CO2dCQUN4QixPQUFPLE1BQU0sQ0FBQztTQUNyQjtJQUNMLENBQUM7SUFFTyxZQUFZLENBQUMsRUFBRTtRQUNuQixRQUFRLEVBQUUsRUFBRTtZQUNSLEtBQUssZ0JBQWdCLENBQUMsV0FBVztnQkFDN0IsT0FBTyxRQUFR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QUssRUFBRSxPQUFPO1FBQzFDLElBQUksR0FBRyxDQUFDO1FBQ1IsSUFBSSxLQUFLLENBQUM7UUFDVixJQUFJLEtBQUssQ0FBQztRQUNWLElBQUksSUFBSSxDQUFDLHdCQUF3QixDQUFDLElBQUksRUFBRSxLQUFLLENBQUMsRUFBRTtZQUM1QyxHQUFHLEdBQUcsSUFBSSxnQkFBZ0IsQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO1lBQzlDLEtBQUssR0FBRyxHQUFHLENBQUMsa0JBQWtCLENBQUMsSUFBSSxFQUFFLEtBQUssQ0FBQyxDQUFDO1lBQzVDLEtBQUssR0FBRyxHQUFHLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxNQUFNLEVBQUUsS0FBSyxDQUFDLE1BQU0sRUFBRSxLQUFLLENBQUMsQ0FBQztZQUN6RCxHQUFHLENBQUMsa0JBQWtCLENBQUMsS0FBSyxFQUFFLEtBQUssQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUMvQyxPQUFPLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxLQUFLLEVBQUUsb0JBQW9CLENBQUMsV0FBVyxDQUFDLFFBQVEsRUFBRSxPQUFPLENBQUMsQ0FBQztTQUM5RjtRQUNELE9BQU8sRUFBRSxDQUFDO0lBQ2QsQ0FBQzs7QUFqTmMsZ0NBQVcsR0FBTztJQUM3QixNQUFNLEVBQUUsQ0FBQztJQUNULFFBQVEsRUFBRSxDQUFDO0NBQ2QsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIGRpZmZfbWF0Y2hfcGF0Y2ggZnJvbSAnZ29vZ2xlLWRpZmYtbWF0Y2gtcGF0Y2gvZGlmZl9tYXRjaF9wYXRjaF91bmNvbXByZXNzZWQnO1xuXG5leHBvcnQgY2xhc3MgRGlmZk1hdGNoUGFjaFNlcnZpY2Uge1xuICAgIHByaXZhdGUgc3RhdGljIGRpc3BsYXlUeXBlOmFueSA9IHtcbiAgICAgICAgSU5TREVMOiAwLFxuICAgICAgICBMSU5FRElGRjogMVxuICAgIH07XG5cbiAgICBwcml2YXRlIGRpZmZDbGFzcyhvcCkge1xuICAgICAgICBzd2l0Y2ggKG9wKSB7XG4gICAgICAgICAgICBjYXNlIGRpZmZfbWF0Y2hfcGF0Y2guRElGRl9JTlNFUlQ6XG4gICAgICAgICAgICAgICAgcmV0dXJuICdpbnMnO1xuICAgICAgICAgICAgY2FzZSBkaWZmX21hdGNoX3BhdGNoLkRJRkZfREVMRVRFOlxuICAgICAgICAgICAgICAgIHJldHVybiAnZGVsJztcbiAgICAgICAgICAgIGRlZmF1bHQ6IC8vIGNhc2UgRElGRl9FUVVBTDpcbiAgICAgICAgICAgICAgICByZXR1cm4gJ21hdGNoJztcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgZGlmZlN5bWJvbChvcCkge1xuICAgICAgICBzd2l0Y2ggKG9wKSB7XG4gICAgICAgICAgICBjYXNlIGRpZmZfbWF0Y2hfcGF0Y2guRElGRl9JTlNFUlQ6XG4gICAgICAgICAgICAgICAgcmV0dXJuICcrJztcbiAgICAgICAgICAgIGNhc2UgZGlmZl9tYXRjaF9wYXRjaC5ESUZGX0RFTEVURTpcbiAgICAgICAgICAgICAgICByZXR1cm4gJy0nO1xuICAgICAgICAgICAgZGVmYXVsdDogLy8gY2FzZSBESUZGX0VRVUFMOlxuICAgICAgICAgICAgICAgIHJldHVybiAnICc7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGRpZmZUYWcob3ApIHtcbiAgICAgICAgc3dpdGNoIChvcCkge1xuICAgICAgICAgICAgY2FzZSBkaWZmX21hdGNoX3BhdGNoLkRJRkZfSU5TRVJUOlxuICAgICAgICAgICAgICAgIHJldHVybiAnaW5zJztcbiAgICAgICAgICAgIGNhc2UgZGlmZl9tYXRjaF9wYXRjaC5ESUZGX0RFTEVURTpcbiAgICAgICAgICAgICAgICByZXR1cm4gJ2RlbCc7XG4gICAgICAgICAgICBkZWZhdWx0OiAvLyBjYXNlIERJRkZfRVFVQUw6XG4gICAgICAgICAgICAgICAgcmV0dXJuICdzcGFuJztcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgZGlmZkF0dHJOYW1lKG9wKSB7XG4gICAgICAgIHN3aXRjaCAob3ApIHtcbiAgICAgICAgICAgIGNhc2UgZGlmZl9tYXRjaF9wYXRjaC5ESUZGX0lOU0VSVDpcbiAgICAgICAgICAgICAgICByZXR1cm4gJ2luc2VydCc7XG4gICAgICAgICAgICBjYXNlIGRpZmZfbWF0Y2hfcGF0Y2guRElGRl9ERUxFVEU6XG4gICAgICAgICAgICAgICAgcmV0dXJuICdkZWxldGUnO1xuICAgICAgICAgICAgZGVmYXVsdDogLy8gY2FzZSBESUZGX0VRVUFMOlxuICAgICAgICAgICAgICAgIHJldHVybiAnZXF1YWwnO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBpc0VtcHR5T2JqZWN0KG8pIHtcbiAgICAgICAgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKG8pLmxlbmd0aCA9PT0gMDtcbiAgICB9XG5cbiAgICBwcml2YXRlIGlzRGVmaW5lZChvKSB7XG4gICAgICAgIHJldHVybiBvICE9IHVuZGVmaW5lZDtcbiAgICB9XG5cbiAgICBwcml2YXRlIGdldFRhZ0F0dHJzKG9wdGlvbnMsIG9wLCBhdHRycz8pIHtcbiAgICAgICAgdmFyIGF0dHJpYnV0ZXMgPSBhdHRycyB8fCB7fTtcbiAgICAgICAgdmFyIHRhZ09wdGlvbnMgPSB7fTtcbiAgICAgICAgdmFyIGF0dHJpYnV0ZTtcbiAgICAgICAgdmFyIHRhZ09wdGlvbjtcbiAgICAgICAgdmFyIHJldFZhbDpzdHJpbmdbXSA9IFtdO1xuXG4gICAgICAgIGlmIChvcHRpb25zICE9IHVuZGVmaW5lZCAmJiBvcHRpb25zLmF0dHJzICE9IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGFnT3B0aW9ucyA9IE9iamVjdC5hc3NpZ24ob3B0aW9ucy5hdHRyc1t0aGlzLmRpZmZBdHRyTmFtZShvcCldIHx8IHt9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLmlzRW1wdHlPYmplY3QodGFnT3B0aW9ucykgJiYgdGhpcy5pc0VtcHR5T2JqZWN0KGF0dHJpYnV0ZXMpKSB7XG4gICAgICAgICAgICByZXR1cm4gJyc7XG4gICAgICAgIH1cblxuICAgICAgICBmb3IgKGF0dHJpYnV0ZSBpbiBhdHRyaWJ1dGVzKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5pc0RlZmluZWQodGFnT3B0aW9uc1thdHRyaWJ1dGVdKSkge1xuICAgICAgICAgICAgICAgIC8vIFRoZSBhdHRyaWJ1dGUgZGVmaW5lZCBpbiBhdHRyaWJ1dGVzIHNob3VsZCBiZSBmaXJzdFxuICAgICAgICAgICAgICAgIHRhZ09wdGlvbnNbYXR0cmlidXRlXSA9IGF0dHJpYnV0ZXNbYXR0cmlidXRlXSArICcgJyArIHRhZ09wdGlvbnNbYXR0cmlidXRlXTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGFnT3B0aW9uc1thdHRyaWJ1dGVdID0gYXR0cmlidXRlc1thdHRyaWJ1dGVdO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLyogZXNsaW50IGd1YXJkLWZvci1pbjogXCJvZmZcIiAqL1xuICAgICAgICBmb3IgKHRhZ09wdGlvbiBpbiB0YWdPcHRpb25zKSB7XG4gICAgICAgICAgICByZXRWYWwucHVzaCh0YWdPcHRpb24gKyAnPVwiJyArIHRhZ09wdGlvbnNbdGFnT3B0aW9uXSArICdcIicpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAnICcgKyByZXRWYWwuam9pbignICcpO1xuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0SHRtbFByZWZpeChvcCwgZGlzcGxheSwgb3B0aW9ucykge1xuICAgICAgICBzd2l0Y2ggKGRpc3BsYXkpIHtcbiAgICAgICAgICAgIGNhc2UgRGlmZk1hdGNoUGFjaFNlcnZpY2UuZGlzcGxheVR5cGUuTElORURJRkY6XG4gICAgICAgICAgICAgICAgcmV0dXJuICc8ZGl2IGNsYXNzPVwiJyArIHRoaXMuZGlmZkNsYXNzKG9wKSArICdcIj48c3BhbicgKyB0aGlzLmdldFRhZ0F0dHJzKG9wdGlvbnMsIG9wLCB7Y2xhc3M6ICdub3NlbGVjdCd9KSArICc+JyArIHRoaXMuZGlmZlN5bWJvbChvcCkgKyAnPC9zcGFuPic7XG4gICAgICAgICAgICBkZWZhdWx0OiAvLyBjYXNlIGRpc3BsYXlUeXBlLklOU0RFTDpcbiAgICAgICAgICAgICAgICByZXR1cm4gJzwnICsgdGhpcy5kaWZmVGFnKG9wKSArIHRoaXMuZ2V0VGFnQXR0cnMob3B0aW9ucywgb3ApICsgJz4nO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXRIdG1sU3VmZml4KG9wLCBkaXNwbGF5KSB7XG4gICAgICAgIHN3aXRjaCAoZGlzcGxheSkge1xuICAgICAgICAgICAgY2FzZSBEaWZmTWF0Y2hQYWNoU2VydmljZS5kaXNwbGF5VHlwZS5MSU5FRElGRjpcbiAgICAgICAgICAgICAgICByZXR1cm4gJzwvZGl2Pic7XG4gICAgICAgICAgICBkZWZhdWx0OiAvLyBjYXNlIGRpc3BsYXlUeXBlLklOU0RFTDpcbiAgICAgICAgICAgICAgICByZXR1cm4gJzwvJyArIHRoaXMuZGlmZlRhZyhvcCkgKyAnPic7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGNyZWF0ZUh0bWxMaW5lcyh0ZXh0LCBvcCwgb3B0aW9ucykge1xuICAgICAgICB2YXIgbGluZXMgPSB0ZXh0LnNwbGl0KCdcXG4nKTtcbiAgICAgICAgdmFyIHk7XG4gICAgICAgIGZvciAoeSA9IDA7IHkgPCBsaW5lcy5sZW5ndGg7IHkrKykge1xuICAgICAgICAgICAgaWYgKGxpbmVzW3ldLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbGluZXNbeV0gPSB0aGlzLmdldEh0bWxQcmVmaXgob3AsIERpZmZNYXRjaFBhY2hTZXJ2aWNlLmRpc3BsYXlUeXBlLkxJTkVESUZGLCBvcHRpb25zKSArIGxpbmVzW3ldICsgdGhpcy5nZXRIdG1sU3VmZml4KG9wLCBEaWZmTWF0Y2hQYWNoU2VydmljZS5kaXNwbGF5VHlwZS5MSU5FRElGRik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGxpbmVzLmpvaW4oJycpO1xuICAgIH1cblxuICAgIHByaXZhdGUgY3JlYXRlSHRtbEZyb21EaWZmcyhkaWZmcywgZGlzcGxheSwgb3B0aW9ucykge1xuICAgICAgICB2YXIgcGF0dGVybkFtcCA9IC8mL2c7XG4gICAgICAgIHZhciBwYXR0ZXJuTHQgPSAvPC9nO1xuICAgICAgICB2YXIgcGF0dGVybkd0ID0gLz4vZztcbiAgICAgICAgdmFyIHg7XG4gICAgICAgIHZhciBodG1sOnN0cmluZ1tdID0gW107XG4gICAgICAgIHZhciB5O1xuICAgICAgICB2YXIgZGF0YTtcbiAgICAgICAgdmFyIG9wO1xuICAgICAgICB2YXIgdGV4dDtcbiAgICAgICAgdmFyIGRpZmZEYXRhID0gZGlmZnM7XG5cbiAgICAgICAgZm9yICh4ID0gMDsgeCA8IGRpZmZEYXRhLmxlbmd0aDsgeCsrKSB7XG4gICAgICAgICAgICBkYXRhID0gZGlmZkRhdGFbeF1bMV07XG4gICAgICAgICAgICBkaWZmRGF0YVt4XVsxXSA9IGRhdGEucmVwbGFjZShwYXR0ZXJuQW1wLCAnJmFtcDsnKVxuICAgICAgICAgICAgICAgIC5yZXBsYWNlKHBhdHRlcm5MdCwgJyZsdDsnKVxuICAgICAgICAgICAgICAgIC5yZXBsYWNlKHBhdHRlcm5HdCwgJyZndDsnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZvciAoeSA9IDA7IHkgPCBkaWZmRGF0YS5sZW5ndGg7IHkrKykge1xuICAgICAgICAgICAgb3AgPSBkaWZmRGF0YVt5XVswXTtcbiAgICAgICAgICAgIHRleHQgPSBkaWZmRGF0YVt5XVsxXTtcbiAgICAgICAgICAgIGlmIChkaXNwbGF5ID09PSBEaWZmTWF0Y2hQYWNoU2VydmljZS5kaXNwbGF5VHlwZS5MSU5FRElGRikge1xuICAgICAgICAgICAgICAgIGh0bWxbeV0gPSB0aGlzLmNyZWF0ZUh0bWxMaW5lcyh0ZXh0LCBvcCwgb3B0aW9ucyk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGh0bWxbeV0gPSB0aGlzLmdldEh0bWxQcmVmaXgob3AsIGRpc3BsYXksIG9wdGlvbnMpICsgdGV4dCArIHRoaXMuZ2V0SHRtbFN1ZmZpeChvcCwgZGlzcGxheSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGh0bWwuam9pbignJyk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBpc1N0cmluZyhteVZhcikge1xuICAgICAgICByZXR1cm4gKHR5cGVvZiBteVZhciA9PT0gJ3N0cmluZycgfHwgbXlWYXIgaW5zdGFuY2VvZiBTdHJpbmcpO1xuICAgIH1cblxuICAgIHByaXZhdGUgYXNzZXJ0QXJndW1lbnRzSXNTdHJpbmdzKGxlZnQsIHJpZ2h0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLmlzU3RyaW5nKGxlZnQpICYmIHRoaXMuaXNTdHJpbmcocmlnaHQpO1xuICAgIH1cblxuICAgIHB1YmxpYyBjcmVhdGVEaWZmSHRtbChsZWZ0LCByaWdodCwgb3B0aW9ucykge1xuICAgICAgICB2YXIgZG1wO1xuICAgICAgICB2YXIgZGlmZnM7XG4gICAgICAgIGlmICh0aGlzLmFzc2VydEFyZ3VtZW50c0lzU3RyaW5ncyhsZWZ0LCByaWdodCkpIHtcbiAgICAgICAgICAgIGRtcCA9IG5ldyBkaWZmX21hdGNoX3BhdGNoLmRpZmZfbWF0Y2hfcGF0Y2goKTtcbiAgICAgICAgICAgIGRpZmZzID0gZG1wLmRpZmZfbWFpbihsZWZ0LCByaWdodCk7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jcmVhdGVIdG1sRnJvbURpZmZzKGRpZmZzLCBEaWZmTWF0Y2hQYWNoU2VydmljZS5kaXNwbGF5VHlwZS5JTlNERUwsIG9wdGlvbnMpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAnJztcbiAgICB9XG5cbi8vICAgIGNyZWF0ZVByb2Nlc3NpbmdEaWZmSHRtbDogZnVuY3Rpb24gY3JlYXRlUHJvY2Vzc2luZ0RpZmZIdG1sKGxlZnQsIHJpZ2h0LCBvcHRpb25zKSB7XG4vLyAgICB2YXIgZG1wO1xuLy8gICAgdmFyIGRpZmZzO1xuLy8gICAgaWYgKGFzc2VydEFyZ3VtZW50c0lzU3RyaW5ncyhsZWZ0LCByaWdodCkpIHtcbi8vICAgICAgICBkbXAgPSBuZXcgZGlmZl9tYXRjaF9wYXRjaCgpO1xuLy8gICAgICAgIGRpZmZzID0gZG1wLmRpZmZfbWFpbihsZWZ0LCByaWdodCk7XG4vL1xuLy8gICAgICAgIGlmIChhbmd1bGFyLmlzRGVmaW5lZChvcHRpb25zKSAmJiBhbmd1bGFyLmlzRGVmaW5lZChvcHRpb25zLmVkaXRDb3N0KSAmJiBpc0Zpbml0ZShvcHRpb25zLmVkaXRDb3N0KSkge1xuLy8gICAgICAgICAgICBkbXAuRGlmZl9FZGl0Q29zdCA9IG9wdGlvbnMuZWRpdENvc3Q7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgY2FtZWxjYXNlXG4vLyAgICAgICAgfVxuLy9cbi8vICAgICAgICBkbXAuZGlmZl9jbGVhbnVwRWZmaWNpZW5jeShkaWZmcyk7XG4vLyAgICAgICAgcmV0dXJuIGNyZWF0ZUh0bWxGcm9tRGlmZnMoZGlmZnMsIGRpc3BsYXlUeXBlLklOU0RFTCwgb3B0aW9ucyk7XG4vLyAgICB9XG4vLyAgICByZXR1cm4gJyc7XG4vL30sXG4vL1xuLy8gICAgY3JlYXRlU2VtYW50aWNEaWZmSHRtbDogZnVuY3Rpb24gY3JlYXRlU2VtYW50aWNEaWZmSHRtbChsZWZ0LCByaWdodCwgb3B0aW9ucykge1xuLy8gICAgdmFyIGRtcDtcbi8vICAgIHZhciBkaWZmcztcbi8vICAgIGlmIChhc3NlcnRBcmd1bWVudHNJc1N0cmluZ3MobGVmdCwgcmlnaHQpKSB7XG4vLyAgICAgICAgZG1wID0gbmV3IGRpZmZfbWF0Y2hfcGF0Y2goKTtcbi8vICAgICAgICBkaWZmcyA9IGRtcC5kaWZmX21haW4obGVmdCwgcmlnaHQpO1xuLy8gICAgICAgIGRtcC5kaWZmX2NsZWFudXBTZW1hbnRpYyhkaWZmcyk7XG4vLyAgICAgICAgcmV0dXJuIGNyZWF0ZUh0bWxGcm9tRGlmZnMoZGlmZnMsIGRpc3BsYXlUeXBlLklOU0RFTCwgb3B0aW9ucyk7XG4vLyAgICB9XG4vLyAgICByZXR1cm4gJyc7XG4vL30sXG5cbiAgICBwdWJsaWMgY3JlYXRlTGluZURpZmZIdG1sKGxlZnQsIHJpZ2h0LCBvcHRpb25zKSB7XG4gICAgICAgIHZhciBkbXA7XG4gICAgICAgIHZhciBjaGFycztcbiAgICAgICAgdmFyIGRpZmZzO1xuICAgICAgICBpZiAodGhpcy5hc3NlcnRBcmd1bWVudHNJc1N0cmluZ3MobGVmdCwgcmlnaHQpKSB7XG4gICAgICAgICAgICBkbXAgPSBuZXcgZGlmZl9tYXRjaF9wYXRjaC5kaWZmX21hdGNoX3BhdGNoKCk7XG4gICAgICAgICAgICBjaGFycyA9IGRtcC5kaWZmX2xpbmVzVG9DaGFyc18obGVmdCwgcmlnaHQpO1xuICAgICAgICAgICAgZGlmZnMgPSBkbXAuZGlmZl9tYWluKGNoYXJzLmNoYXJzMSwgY2hhcnMuY2hhcnMyLCBmYWxzZSk7XG4gICAgICAgICAgICBkbXAuZGlmZl9jaGFyc1RvTGluZXNfKGRpZmZzLCBjaGFycy5saW5lQXJyYXkpO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlSHRtbEZyb21EaWZmcyhkaWZmcywgRGlmZk1hdGNoUGFjaFNlcnZpY2UuZGlzcGxheVR5cGUuTElORURJRkYsIG9wdGlvbnMpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAnJztcbiAgICB9XG59XG4iXX0=