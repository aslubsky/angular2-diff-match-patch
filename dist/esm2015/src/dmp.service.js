/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
export class DiffMatchPachService {
    /**
     * @param {?} op
     * @return {?}
     */
    diffClass(op) {
        switch (op) {
            case (/** @type {?} */ (window)).diff_match_patch.DIFF_INSERT:
                return 'ins';
            case (/** @type {?} */ (window)).diff_match_patch.DIFF_DELETE:
                return 'del';
            default:
                // case DIFF_EQUAL:
                return 'match';
        }
    }
    /**
     * @param {?} op
     * @return {?}
     */
    diffSymbol(op) {
        switch (op) {
            case (/** @type {?} */ (window)).diff_match_patch.DIFF_INSERT:
                return '+';
            case (/** @type {?} */ (window)).diff_match_patch.DIFF_DELETE:
                return '-';
            default:
                // case DIFF_EQUAL:
                return ' ';
        }
    }
    /**
     * @param {?} op
     * @return {?}
     */
    diffTag(op) {
        switch (op) {
            case (/** @type {?} */ (window)).diff_match_patch.DIFF_INSERT:
                return 'ins';
            case (/** @type {?} */ (window)).diff_match_patch.DIFF_DELETE:
                return 'del';
            default:
                // case DIFF_EQUAL:
                return 'span';
        }
    }
    /**
     * @param {?} op
     * @return {?}
     */
    diffAttrName(op) {
        switch (op) {
            case (/** @type {?} */ (window)).diff_match_patch.DIFF_INSERT:
                return 'insert';
            case (/** @type {?} */ (window)).diff_match_patch.DIFF_DELETE:
                return 'delete';
            default:
                // case DIFF_EQUAL:
                return 'equal';
        }
    }
    /**
     * @param {?} o
     * @return {?}
     */
    isEmptyObject(o) {
        return Object.getOwnPropertyNames(o).length === 0;
    }
    /**
     * @param {?} o
     * @return {?}
     */
    isDefined(o) {
        return o != undefined;
    }
    /**
     * @param {?} options
     * @param {?} op
     * @param {?=} attrs
     * @return {?}
     */
    getTagAttrs(options, op, attrs) {
        var /** @type {?} */ attributes = attrs || {};
        var /** @type {?} */ tagOptions = {};
        var /** @type {?} */ attribute;
        var /** @type {?} */ tagOption;
        var /** @type {?} */ retVal = [];
        if (options != undefined && options.attrs != undefined) {
            tagOptions = Object.assign(options.attrs[this.diffAttrName(op)] || {});
        }
        if (this.isEmptyObject(tagOptions) && this.isEmptyObject(attributes)) {
            return '';
        }
        for (attribute in attributes) {
            if (this.isDefined(tagOptions[attribute])) {
                // The attribute defined in attributes should be first
                tagOptions[attribute] = attributes[attribute] + ' ' + tagOptions[attribute];
            }
            else {
                tagOptions[attribute] = attributes[attribute];
            }
        }
        /* eslint guard-for-in: "off" */
        for (tagOption in tagOptions) {
            retVal.push(tagOption + '="' + tagOptions[tagOption] + '"');
        }
        return ' ' + retVal.join(' ');
    }
    /**
     * @param {?} op
     * @param {?} display
     * @param {?} options
     * @return {?}
     */
    getHtmlPrefix(op, display, options) {
        switch (display) {
            case DiffMatchPachService.displayType.LINEDIFF:
                return '<div class="' + this.diffClass(op) + '"><span' + this.getTagAttrs(options, op, { class: 'noselect' }) + '>' + this.diffSymbol(op) + '</span>';
            default:
                // case displayType.INSDEL:
                return '<' + this.diffTag(op) + this.getTagAttrs(options, op) + '>';
        }
    }
    /**
     * @param {?} op
     * @param {?} display
     * @return {?}
     */
    getHtmlSuffix(op, display) {
        switch (display) {
            case DiffMatchPachService.displayType.LINEDIFF:
                return '</div>';
            default:
                // case displayType.INSDEL:
                return '</' + this.diffTag(op) + '>';
        }
    }
    /**
     * @param {?} text
     * @param {?} op
     * @param {?} options
     * @return {?}
     */
    createHtmlLines(text, op, options) {
        var /** @type {?} */ lines = text.split('\n');
        var /** @type {?} */ y;
        for (y = 0; y < lines.length; y++) {
            if (lines[y].length === 0) {
                continue;
            }
            lines[y] = this.getHtmlPrefix(op, DiffMatchPachService.displayType.LINEDIFF, options) + lines[y] + this.getHtmlSuffix(op, DiffMatchPachService.displayType.LINEDIFF);
        }
        return lines.join('');
    }
    /**
     * @param {?} diffs
     * @param {?} display
     * @param {?} options
     * @return {?}
     */
    createHtmlFromDiffs(diffs, display, options) {
        var /** @type {?} */ patternAmp = /&/g;
        var /** @type {?} */ patternLt = /</g;
        var /** @type {?} */ patternGt = />/g;
        var /** @type {?} */ x;
        var /** @type {?} */ html = [];
        var /** @type {?} */ y;
        var /** @type {?} */ data;
        var /** @type {?} */ op;
        var /** @type {?} */ text;
        var /** @type {?} */ diffData = diffs;
        for (x = 0; x < diffData.length; x++) {
            data = diffData[x][1];
            diffData[x][1] = data.replace(patternAmp, '&amp;')
                .replace(patternLt, '&lt;')
                .replace(patternGt, '&gt;');
        }
        for (y = 0; y < diffData.length; y++) {
            op = diffData[y][0];
            text = diffData[y][1];
            if (display === DiffMatchPachService.displayType.LINEDIFF) {
                html[y] = this.createHtmlLines(text, op, options);
            }
            else {
                html[y] = this.getHtmlPrefix(op, display, options) + text + this.getHtmlSuffix(op, display);
            }
        }
        return html.join('');
    }
    /**
     * @param {?} myVar
     * @return {?}
     */
    isString(myVar) {
        return (typeof myVar === 'string' || myVar instanceof String);
    }
    /**
     * @param {?} left
     * @param {?} right
     * @return {?}
     */
    assertArgumentsIsStrings(left, right) {
        return this.isString(left) && this.isString(right);
    }
    /**
     * @param {?} left
     * @param {?} right
     * @param {?} options
     * @return {?}
     */
    createDiffHtml(left, right, options) {
        var /** @type {?} */ dmp;
        var /** @type {?} */ diffs;
        if (this.assertArgumentsIsStrings(left, right)) {
            dmp = new (/** @type {?} */ (window)).diff_match_patch.diff_match_patch();
            diffs = dmp.diff_main(left, right);
            return this.createHtmlFromDiffs(diffs, DiffMatchPachService.displayType.INSDEL, options);
        }
        return '';
    }
    /**
     * @param {?} left
     * @param {?} right
     * @param {?} options
     * @return {?}
     */
    createLineDiffHtml(left, right, options) {
        var /** @type {?} */ dmp;
        var /** @type {?} */ chars;
        var /** @type {?} */ diffs;
        if (this.assertArgumentsIsStrings(left, right)) {
            dmp = new (/** @type {?} */ (window)).diff_match_patch.diff_match_patch();
            chars = dmp.diff_linesToChars_(left, right);
            diffs = dmp.diff_main(chars.chars1, chars.chars2, false);
            dmp.diff_charsToLines_(diffs, chars.lineArray);
            return this.createHtmlFromDiffs(diffs, DiffMatchPachService.displayType.LINEDIFF, options);
        }
        return '';
    }
}
DiffMatchPachService.displayType = {
    INSDEL: 0,
    LINEDIFF: 1
};
function DiffMatchPachService_tsickle_Closure_declarations() {
    /** @type {?} */
    DiffMatchPachService.displayType;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZG1wLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9hbmd1bGFyMi1kaWZmLW1hdGNoLXBhdGNoLyIsInNvdXJjZXMiOlsic3JjL2RtcC5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxNQUFNOzs7OztJQU1NLFNBQVMsQ0FBQyxFQUFFO1FBQ2hCLE1BQU0sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFDVCxLQUFLLG1CQUFNLE1BQU0sRUFBQyxDQUFDLGdCQUFnQixDQUFDLFdBQVc7Z0JBQzNDLE1BQU0sQ0FBQyxLQUFLLENBQUM7WUFDakIsS0FBSyxtQkFBTSxNQUFNLEVBQUMsQ0FBQyxnQkFBZ0IsQ0FBQyxXQUFXO2dCQUMzQyxNQUFNLENBQUMsS0FBSyxDQUFDO1lBQ2pCOztnQkFDSSxNQUFNLENBQUMsT0FBTyxDQUFDO1NBQ3RCOzs7Ozs7SUFHRyxVQUFVLENBQUMsRUFBRTtRQUNqQixNQUFNLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1lBQ1QsS0FBSyxtQkFBTSxNQUFNLEVBQUMsQ0FBQyxnQkFBZ0IsQ0FBQyxXQUFXO2dCQUMzQyxNQUFNLENBQUMsR0FBRyxDQUFDO1lBQ2YsS0FBSyxtQkFBTSxNQUFNLEVBQUMsQ0FBQyxnQkFBZ0IsQ0FBQyxXQUFXO2dCQUMzQyxNQUFNLENBQUMsR0FBRyxDQUFDO1lBQ2Y7O2dCQUNJLE1BQU0sQ0FBQyxHQUFHLENBQUM7U0FDbEI7Ozs7OztJQUdHLE9BQU8sQ0FBQyxFQUFFO1FBQ2QsTUFBTSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztZQUNULEtBQUssbUJBQU0sTUFBTSxFQUFDLENBQUMsZ0JBQWdCLENBQUMsV0FBVztnQkFDM0MsTUFBTSxDQUFDLEtBQUssQ0FBQztZQUNqQixLQUFLLG1CQUFNLE1BQU0sRUFBQyxDQUFDLGdCQUFnQixDQUFDLFdBQVc7Z0JBQzNDLE1BQU0sQ0FBQyxLQUFLLENBQUM7WUFDakI7O2dCQUNJLE1BQU0sQ0FB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QkFBbUIsQ0FBQyxLQUFLLEVBQUUsb0JBQW9CLENBQUMsV0FBVyxDQUFDLE1BQU0sRUFBRSxPQUFPLENBQUMsQ0FBQztTQUM1RjtRQUNELE1BQU0sQ0FBQyxFQUFFLENBQUM7Ozs7Ozs7O0lBZ0NQLGtCQUFrQixDQUFDLElBQUksRUFBRSxLQUFLLEVBQUUsT0FBTztRQUMxQyxxQkFBSSxHQUFHLENBQUM7UUFDUixxQkFBSSxLQUFLLENBQUM7UUFDVixxQkFBSSxLQUFLLENBQUM7UUFDVixFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsd0JBQXdCLENBQUMsSUFBSSxFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUM3QyxHQUFHLEdBQUcsSUFBSSxtQkFBTSxNQUFNLEVBQUMsQ0FBQyxnQkFBZ0IsQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO1lBQzVELEtBQUssR0FBRyxHQUFHLENBQUMsa0JBQWtCLENBQUMsSUFBSSxFQUFFLEtBQUssQ0FBQyxDQUFDO1lBQzVDLEtBQUssR0FBRyxHQUFHLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxNQUFNLEVBQUUsS0FBSyxDQUFDLE1BQU0sRUFBRSxLQUFLLENBQUMsQ0FBQztZQUN6RCxHQUFHLENBQUMsa0JBQWtCLENBQUMsS0FBSyxFQUFFLEtBQUssQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUMvQyxNQUFNLENBQUMsSUFBSSxDQUFDLG1CQUFtQixDQUFDLEtBQUssRUFBRSxvQkFBb0IsQ0FBQyxXQUFXLENBQUMsUUFBUSxFQUFFLE9BQU8sQ0FBQyxDQUFDO1NBQzlGO1FBQ0QsTUFBTSxDQUFDLEVBQUUsQ0FBQzs7O21DQWhObUI7SUFDN0IsTUFBTSxFQUFFLENBQUM7SUFDVCxRQUFRLEVBQUUsQ0FBQztDQUNkIiwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGNsYXNzIERpZmZNYXRjaFBhY2hTZXJ2aWNlIHtcbiAgICBwcml2YXRlIHN0YXRpYyBkaXNwbGF5VHlwZTphbnkgPSB7XG4gICAgICAgIElOU0RFTDogMCxcbiAgICAgICAgTElORURJRkY6IDFcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBkaWZmQ2xhc3Mob3ApIHtcbiAgICAgICAgc3dpdGNoIChvcCkge1xuICAgICAgICAgICAgY2FzZSAoPGFueT53aW5kb3cpLmRpZmZfbWF0Y2hfcGF0Y2guRElGRl9JTlNFUlQ6XG4gICAgICAgICAgICAgICAgcmV0dXJuICdpbnMnO1xuICAgICAgICAgICAgY2FzZSAoPGFueT53aW5kb3cpLmRpZmZfbWF0Y2hfcGF0Y2guRElGRl9ERUxFVEU6XG4gICAgICAgICAgICAgICAgcmV0dXJuICdkZWwnO1xuICAgICAgICAgICAgZGVmYXVsdDogLy8gY2FzZSBESUZGX0VRVUFMOlxuICAgICAgICAgICAgICAgIHJldHVybiAnbWF0Y2gnO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBkaWZmU3ltYm9sKG9wKSB7XG4gICAgICAgIHN3aXRjaCAob3ApIHtcbiAgICAgICAgICAgIGNhc2UgKDxhbnk+d2luZG93KS5kaWZmX21hdGNoX3BhdGNoLkRJRkZfSU5TRVJUOlxuICAgICAgICAgICAgICAgIHJldHVybiAnKyc7XG4gICAgICAgICAgICBjYXNlICg8YW55PndpbmRvdykuZGlmZl9tYXRjaF9wYXRjaC5ESUZGX0RFTEVURTpcbiAgICAgICAgICAgICAgICByZXR1cm4gJy0nO1xuICAgICAgICAgICAgZGVmYXVsdDogLy8gY2FzZSBESUZGX0VRVUFMOlxuICAgICAgICAgICAgICAgIHJldHVybiAnICc7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGRpZmZUYWcob3ApIHtcbiAgICAgICAgc3dpdGNoIChvcCkge1xuICAgICAgICAgICAgY2FzZSAoPGFueT53aW5kb3cpLmRpZmZfbWF0Y2hfcGF0Y2guRElGRl9JTlNFUlQ6XG4gICAgICAgICAgICAgICAgcmV0dXJuICdpbnMnO1xuICAgICAgICAgICAgY2FzZSAoPGFueT53aW5kb3cpLmRpZmZfbWF0Y2hfcGF0Y2guRElGRl9ERUxFVEU6XG4gICAgICAgICAgICAgICAgcmV0dXJuICdkZWwnO1xuICAgICAgICAgICAgZGVmYXVsdDogLy8gY2FzZSBESUZGX0VRVUFMOlxuICAgICAgICAgICAgICAgIHJldHVybiAnc3Bhbic7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGRpZmZBdHRyTmFtZShvcCkge1xuICAgICAgICBzd2l0Y2ggKG9wKSB7XG4gICAgICAgICAgICBjYXNlICg8YW55PndpbmRvdykuZGlmZl9tYXRjaF9wYXRjaC5ESUZGX0lOU0VSVDpcbiAgICAgICAgICAgICAgICByZXR1cm4gJ2luc2VydCc7XG4gICAgICAgICAgICBjYXNlICg8YW55PndpbmRvdykuZGlmZl9tYXRjaF9wYXRjaC5ESUZGX0RFTEVURTpcbiAgICAgICAgICAgICAgICByZXR1cm4gJ2RlbGV0ZSc7XG4gICAgICAgICAgICBkZWZhdWx0OiAvLyBjYXNlIERJRkZfRVFVQUw6XG4gICAgICAgICAgICAgICAgcmV0dXJuICdlcXVhbCc7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGlzRW1wdHlPYmplY3Qobykge1xuICAgICAgICByZXR1cm4gT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMobykubGVuZ3RoID09PSAwO1xuICAgIH1cblxuICAgIHByaXZhdGUgaXNEZWZpbmVkKG8pIHtcbiAgICAgICAgcmV0dXJuIG8gIT0gdW5kZWZpbmVkO1xuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0VGFnQXR0cnMob3B0aW9ucywgb3AsIGF0dHJzPykge1xuICAgICAgICB2YXIgYXR0cmlidXRlcyA9IGF0dHJzIHx8IHt9O1xuICAgICAgICB2YXIgdGFnT3B0aW9ucyA9IHt9O1xuICAgICAgICB2YXIgYXR0cmlidXRlO1xuICAgICAgICB2YXIgdGFnT3B0aW9uO1xuICAgICAgICB2YXIgcmV0VmFsID0gW107XG5cbiAgICAgICAgaWYgKG9wdGlvbnMgIT0gdW5kZWZpbmVkICYmIG9wdGlvbnMuYXR0cnMgIT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0YWdPcHRpb25zID0gT2JqZWN0LmFzc2lnbihvcHRpb25zLmF0dHJzW3RoaXMuZGlmZkF0dHJOYW1lKG9wKV0gfHwge30pO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuaXNFbXB0eU9iamVjdCh0YWdPcHRpb25zKSAmJiB0aGlzLmlzRW1wdHlPYmplY3QoYXR0cmlidXRlcykpIHtcbiAgICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgfVxuXG4gICAgICAgIGZvciAoYXR0cmlidXRlIGluIGF0dHJpYnV0ZXMpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmlzRGVmaW5lZCh0YWdPcHRpb25zW2F0dHJpYnV0ZV0pKSB7XG4gICAgICAgICAgICAgICAgLy8gVGhlIGF0dHJpYnV0ZSBkZWZpbmVkIGluIGF0dHJpYnV0ZXMgc2hvdWxkIGJlIGZpcnN0XG4gICAgICAgICAgICAgICAgdGFnT3B0aW9uc1thdHRyaWJ1dGVdID0gYXR0cmlidXRlc1thdHRyaWJ1dGVdICsgJyAnICsgdGFnT3B0aW9uc1thdHRyaWJ1dGVdO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0YWdPcHRpb25zW2F0dHJpYnV0ZV0gPSBhdHRyaWJ1dGVzW2F0dHJpYnV0ZV07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvKiBlc2xpbnQgZ3VhcmQtZm9yLWluOiBcIm9mZlwiICovXG4gICAgICAgIGZvciAodGFnT3B0aW9uIGluIHRhZ09wdGlvbnMpIHtcbiAgICAgICAgICAgIHJldFZhbC5wdXNoKHRhZ09wdGlvbiArICc9XCInICsgdGFnT3B0aW9uc1t0YWdPcHRpb25dICsgJ1wiJyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuICcgJyArIHJldFZhbC5qb2luKCcgJyk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXRIdG1sUHJlZml4KG9wLCBkaXNwbGF5LCBvcHRpb25zKSB7XG4gICAgICAgIHN3aXRjaCAoZGlzcGxheSkge1xuICAgICAgICAgICAgY2FzZSBEaWZmTWF0Y2hQYWNoU2VydmljZS5kaXNwbGF5VHlwZS5MSU5FRElGRjpcbiAgICAgICAgICAgICAgICByZXR1cm4gJzxkaXYgY2xhc3M9XCInICsgdGhpcy5kaWZmQ2xhc3Mob3ApICsgJ1wiPjxzcGFuJyArIHRoaXMuZ2V0VGFnQXR0cnMob3B0aW9ucywgb3AsIHtjbGFzczogJ25vc2VsZWN0J30pICsgJz4nICsgdGhpcy5kaWZmU3ltYm9sKG9wKSArICc8L3NwYW4+JztcbiAgICAgICAgICAgIGRlZmF1bHQ6IC8vIGNhc2UgZGlzcGxheVR5cGUuSU5TREVMOlxuICAgICAgICAgICAgICAgIHJldHVybiAnPCcgKyB0aGlzLmRpZmZUYWcob3ApICsgdGhpcy5nZXRUYWdBdHRycyhvcHRpb25zLCBvcCkgKyAnPic7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGdldEh0bWxTdWZmaXgob3AsIGRpc3BsYXkpIHtcbiAgICAgICAgc3dpdGNoIChkaXNwbGF5KSB7XG4gICAgICAgICAgICBjYXNlIERpZmZNYXRjaFBhY2hTZXJ2aWNlLmRpc3BsYXlUeXBlLkxJTkVESUZGOlxuICAgICAgICAgICAgICAgIHJldHVybiAnPC9kaXY+JztcbiAgICAgICAgICAgIGRlZmF1bHQ6IC8vIGNhc2UgZGlzcGxheVR5cGUuSU5TREVMOlxuICAgICAgICAgICAgICAgIHJldHVybiAnPC8nICsgdGhpcy5kaWZmVGFnKG9wKSArICc+JztcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgY3JlYXRlSHRtbExpbmVzKHRleHQsIG9wLCBvcHRpb25zKSB7XG4gICAgICAgIHZhciBsaW5lcyA9IHRleHQuc3BsaXQoJ1xcbicpO1xuICAgICAgICB2YXIgeTtcbiAgICAgICAgZm9yICh5ID0gMDsgeSA8IGxpbmVzLmxlbmd0aDsgeSsrKSB7XG4gICAgICAgICAgICBpZiAobGluZXNbeV0ubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsaW5lc1t5XSA9IHRoaXMuZ2V0SHRtbFByZWZpeChvcCwgRGlmZk1hdGNoUGFjaFNlcnZpY2UuZGlzcGxheVR5cGUuTElORURJRkYsIG9wdGlvbnMpICsgbGluZXNbeV0gKyB0aGlzLmdldEh0bWxTdWZmaXgob3AsIERpZmZNYXRjaFBhY2hTZXJ2aWNlLmRpc3BsYXlUeXBlLkxJTkVESUZGKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbGluZXMuam9pbignJyk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBjcmVhdGVIdG1sRnJvbURpZmZzKGRpZmZzLCBkaXNwbGF5LCBvcHRpb25zKSB7XG4gICAgICAgIHZhciBwYXR0ZXJuQW1wID0gLyYvZztcbiAgICAgICAgdmFyIHBhdHRlcm5MdCA9IC88L2c7XG4gICAgICAgIHZhciBwYXR0ZXJuR3QgPSAvPi9nO1xuICAgICAgICB2YXIgeDtcbiAgICAgICAgdmFyIGh0bWwgPSBbXTtcbiAgICAgICAgdmFyIHk7XG4gICAgICAgIHZhciBkYXRhO1xuICAgICAgICB2YXIgb3A7XG4gICAgICAgIHZhciB0ZXh0O1xuICAgICAgICB2YXIgZGlmZkRhdGEgPSBkaWZmcztcblxuICAgICAgICBmb3IgKHggPSAwOyB4IDwgZGlmZkRhdGEubGVuZ3RoOyB4KyspIHtcbiAgICAgICAgICAgIGRhdGEgPSBkaWZmRGF0YVt4XVsxXTtcbiAgICAgICAgICAgIGRpZmZEYXRhW3hdWzFdID0gZGF0YS5yZXBsYWNlKHBhdHRlcm5BbXAsICcmYW1wOycpXG4gICAgICAgICAgICAgICAgLnJlcGxhY2UocGF0dGVybkx0LCAnJmx0OycpXG4gICAgICAgICAgICAgICAgLnJlcGxhY2UocGF0dGVybkd0LCAnJmd0OycpO1xuICAgICAgICB9XG5cbiAgICAgICAgZm9yICh5ID0gMDsgeSA8IGRpZmZEYXRhLmxlbmd0aDsgeSsrKSB7XG4gICAgICAgICAgICBvcCA9IGRpZmZEYXRhW3ldWzBdO1xuICAgICAgICAgICAgdGV4dCA9IGRpZmZEYXRhW3ldWzFdO1xuICAgICAgICAgICAgaWYgKGRpc3BsYXkgPT09IERpZmZNYXRjaFBhY2hTZXJ2aWNlLmRpc3BsYXlUeXBlLkxJTkVESUZGKSB7XG4gICAgICAgICAgICAgICAgaHRtbFt5XSA9IHRoaXMuY3JlYXRlSHRtbExpbmVzKHRleHQsIG9wLCBvcHRpb25zKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaHRtbFt5XSA9IHRoaXMuZ2V0SHRtbFByZWZpeChvcCwgZGlzcGxheSwgb3B0aW9ucykgKyB0ZXh0ICsgdGhpcy5nZXRIdG1sU3VmZml4KG9wLCBkaXNwbGF5KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gaHRtbC5qb2luKCcnKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGlzU3RyaW5nKG15VmFyKSB7XG4gICAgICAgIHJldHVybiAodHlwZW9mIG15VmFyID09PSAnc3RyaW5nJyB8fCBteVZhciBpbnN0YW5jZW9mIFN0cmluZyk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBhc3NlcnRBcmd1bWVudHNJc1N0cmluZ3MobGVmdCwgcmlnaHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaXNTdHJpbmcobGVmdCkgJiYgdGhpcy5pc1N0cmluZyhyaWdodCk7XG4gICAgfVxuXG4gICAgcHVibGljIGNyZWF0ZURpZmZIdG1sKGxlZnQsIHJpZ2h0LCBvcHRpb25zKSB7XG4gICAgICAgIHZhciBkbXA7XG4gICAgICAgIHZhciBkaWZmcztcbiAgICAgICAgaWYgKHRoaXMuYXNzZXJ0QXJndW1lbnRzSXNTdHJpbmdzKGxlZnQsIHJpZ2h0KSkge1xuICAgICAgICAgICAgZG1wID0gbmV3ICg8YW55PndpbmRvdykuZGlmZl9tYXRjaF9wYXRjaC5kaWZmX21hdGNoX3BhdGNoKCk7XG4gICAgICAgICAgICBkaWZmcyA9IGRtcC5kaWZmX21haW4obGVmdCwgcmlnaHQpO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlSHRtbEZyb21EaWZmcyhkaWZmcywgRGlmZk1hdGNoUGFjaFNlcnZpY2UuZGlzcGxheVR5cGUuSU5TREVMLCBvcHRpb25zKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gJyc7XG4gICAgfVxuXG4vLyAgICBjcmVhdGVQcm9jZXNzaW5nRGlmZkh0bWw6IGZ1bmN0aW9uIGNyZWF0ZVByb2Nlc3NpbmdEaWZmSHRtbChsZWZ0LCByaWdodCwgb3B0aW9ucykge1xuLy8gICAgdmFyIGRtcDtcbi8vICAgIHZhciBkaWZmcztcbi8vICAgIGlmIChhc3NlcnRBcmd1bWVudHNJc1N0cmluZ3MobGVmdCwgcmlnaHQpKSB7XG4vLyAgICAgICAgZG1wID0gbmV3ICg8YW55PndpbmRvdykuZGlmZl9tYXRjaF9wYXRjaCgpO1xuLy8gICAgICAgIGRpZmZzID0gZG1wLmRpZmZfbWFpbihsZWZ0LCByaWdodCk7XG4vL1xuLy8gICAgICAgIGlmIChhbmd1bGFyLmlzRGVmaW5lZChvcHRpb25zKSAmJiBhbmd1bGFyLmlzRGVmaW5lZChvcHRpb25zLmVkaXRDb3N0KSAmJiBpc0Zpbml0ZShvcHRpb25zLmVkaXRDb3N0KSkge1xuLy8gICAgICAgICAgICBkbXAuRGlmZl9FZGl0Q29zdCA9IG9wdGlvbnMuZWRpdENvc3Q7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgY2FtZWxjYXNlXG4vLyAgICAgICAgfVxuLy9cbi8vICAgICAgICBkbXAuZGlmZl9jbGVhbnVwRWZmaWNpZW5jeShkaWZmcyk7XG4vLyAgICAgICAgcmV0dXJuIGNyZWF0ZUh0bWxGcm9tRGlmZnMoZGlmZnMsIGRpc3BsYXlUeXBlLklOU0RFTCwgb3B0aW9ucyk7XG4vLyAgICB9XG4vLyAgICByZXR1cm4gJyc7XG4vL30sXG4vL1xuLy8gICAgY3JlYXRlU2VtYW50aWNEaWZmSHRtbDogZnVuY3Rpb24gY3JlYXRlU2VtYW50aWNEaWZmSHRtbChsZWZ0LCByaWdodCwgb3B0aW9ucykge1xuLy8gICAgdmFyIGRtcDtcbi8vICAgIHZhciBkaWZmcztcbi8vICAgIGlmIChhc3NlcnRBcmd1bWVudHNJc1N0cmluZ3MobGVmdCwgcmlnaHQpKSB7XG4vLyAgICAgICAgZG1wID0gbmV3ICg8YW55PndpbmRvdykuZGlmZl9tYXRjaF9wYXRjaCgpO1xuLy8gICAgICAgIGRpZmZzID0gZG1wLmRpZmZfbWFpbihsZWZ0LCByaWdodCk7XG4vLyAgICAgICAgZG1wLmRpZmZfY2xlYW51cFNlbWFudGljKGRpZmZzKTtcbi8vICAgICAgICByZXR1cm4gY3JlYXRlSHRtbEZyb21EaWZmcyhkaWZmcywgZGlzcGxheVR5cGUuSU5TREVMLCBvcHRpb25zKTtcbi8vICAgIH1cbi8vICAgIHJldHVybiAnJztcbi8vfSxcblxuICAgIHB1YmxpYyBjcmVhdGVMaW5lRGlmZkh0bWwobGVmdCwgcmlnaHQsIG9wdGlvbnMpIHtcbiAgICAgICAgdmFyIGRtcDtcbiAgICAgICAgdmFyIGNoYXJzO1xuICAgICAgICB2YXIgZGlmZnM7XG4gICAgICAgIGlmICh0aGlzLmFzc2VydEFyZ3VtZW50c0lzU3RyaW5ncyhsZWZ0LCByaWdodCkpIHtcbiAgICAgICAgICAgIGRtcCA9IG5ldyAoPGFueT53aW5kb3cpLmRpZmZfbWF0Y2hfcGF0Y2guZGlmZl9tYXRjaF9wYXRjaCgpO1xuICAgICAgICAgICAgY2hhcnMgPSBkbXAuZGlmZl9saW5lc1RvQ2hhcnNfKGxlZnQsIHJpZ2h0KTtcbiAgICAgICAgICAgIGRpZmZzID0gZG1wLmRpZmZfbWFpbihjaGFycy5jaGFyczEsIGNoYXJzLmNoYXJzMiwgZmFsc2UpO1xuICAgICAgICAgICAgZG1wLmRpZmZfY2hhcnNUb0xpbmVzXyhkaWZmcywgY2hhcnMubGluZUFycmF5KTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmNyZWF0ZUh0bWxGcm9tRGlmZnMoZGlmZnMsIERpZmZNYXRjaFBhY2hTZXJ2aWNlLmRpc3BsYXlUeXBlLkxJTkVESUZGLCBvcHRpb25zKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gJyc7XG4gICAgfVxufVxuIl19